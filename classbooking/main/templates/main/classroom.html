{% extends "main/master/index.html" %}
<!---->
{% block title %}
  ห้องเรียน
{% endblock title %}
<!---->
{% block content %}
  <style>
  .progress {
    height: 10px;
  }
  </style>
  <div class="container mt-4">
    <div class="content-card">
      <h2>ห้องเรียน</h2>
      {% if request.user.is_staff %}
        <div class="d-grid mt-4">
          <a href="{% url 'classroom_add' %}" class="btn btn-primary mb-3">เพิ่มรายชื่อห้องเรียน</a>
        </div>
      {% endif %}
      {% if classrooms %}
        <div class="row">
          {% for room in classrooms %}
            <div class="col-md-4">
              <div class="content-card">
                <h5>{{ room.name }}</h5>
                <p>
                  หมายเลขห้อง: {{ room.room_number }}
                  <br>
                  สถานะ:
                  {% if room.is_available %}
                    <span class="text-success">เปิดให้จองได้</span>
                  {% else %}
                    <span class="text-danger">จองเต็มแล้ว</span>
                  {% endif %}
                  {% if room.booked_by %}
                    <br>
                    จองโดย: {{ room.booked_by.username }} (และอื่นๆ)
                  {% endif %}
                  <br>
                  เวลาที่เหลือให้จอง: {{ room.hours_left }} จาก {{ room.total_hours }} ชม.
                  <br>
                </p>
                <!-- Hours Left Progress Bar -->
                {% load divide %}
                <div class="mb-2">
                  <div class="progress">
                    <div class="progress-bar {% if room.hours_left|divide:room.total_hours > 50 %} bg-success {% elif room.hours_left|divide:room.total_hours > 25 %} bg-warning {% else %} bg-danger {% endif %}"
                         role="progressbar"
                         style="width: {{ room.hours_left|divide:room.total_hours|floatformat:0 }}%"
                         aria-valuenow="{{ room.hours_left }}"
                         aria-valuemin="0"
                         aria-valuemax="{{ room.total_hours }}"></div>
                  </div>
                </div>
                {% if request.user.is_staff %}
                  <br>
                  <a href="{% url 'classroom_edit' room.id %}"
                     class="btn btn-sm btn-warning">แก้ไข</a>
                  <a href="{% url 'classroom_remove' room.id %}"
                     class="btn btn-sm btn-danger">สั่งลบ</a>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      {% elif not request.user.is_staff %}
        <h5 class="text-muted mt-4">ไม่มีรายชื่อห้องเรียนในขณะนี้</h5>
      {% endif %}
    </div>
  </div>
{% endblock content %}
